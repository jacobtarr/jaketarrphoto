{% macro renderImage(image, smallWidth, largeWidth, altText, transform = null, loading = 'lazy') %}
  {% if image %}
    {% set isObject = image is iterable and image is not string %}

    {% if transform and isObject %}
      {% set webpSrc = image.getUrl({ transform: transform, format: 'webp' }) %}
      {% set jpegSrc = image.getUrl({ transform: transform }) %}

      {# Get actual transform width to use in srcset #}
      {% set transformObj = craft.app.imageTransforms.getTransformByHandle(transform) %}
      {% set width = transformObj.width ?? largeWidth %}
    {% elseif isObject %}
      {% set webpSrc = image.getUrl({ width: largeWidth, format: 'webp' }) %}
      {% set jpegSrc = image.getUrl({ width: largeWidth }) %}
      {% set width = largeWidth %}
    {% else %}
      {% set webpSrc = image %}
      {% set jpegSrc = image %}
      {% set width = largeWidth %}
    {% endif %}

    <picture>
      <source srcset="{{ webpSrc }}" type="image/webp">
      <img 
        src="{{ jpegSrc }}"
        srcset="{{ jpegSrc }} {{ width }}w"
        sizes="(max-width: 768px) 100vw, 50vw"
        alt="{{ altText }}"
        loading="{{ loading }}"
        width="{{ width }}"
        height="auto"
        class="w-full h-full object-cover"
      >
    </picture>
  {% endif %}
{% endmacro %}
