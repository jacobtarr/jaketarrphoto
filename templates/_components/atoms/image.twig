{% macro renderImage(image, smallWidth, largeWidth, altText, transform = null, loading = 'lazy') %}
  {% if image %}
    {% set isObject = image is iterable and image is not string %}

    {% if transform and isObject %}
      {% set webpSrc = image.getUrl({ transform: transform, format: 'webp' }) %}
      {% set jpegSrc = image.getUrl({ transform: transform }) %}
    {% elseif isObject %}
      {% set webpSrc = image.getUrl({ width: largeWidth, format: 'webp' }) %}
      {% set jpegSrc = image.getUrl({ width: largeWidth }) %}
    {% else %}
      {# fallback if image is just a string url #}
      {% set webpSrc = image %}
      {% set jpegSrc = image %}
    {% endif %}

    <picture>
      <source srcset="{{ webpSrc }}" type="image/webp">
      <img 
        src="{{ jpegSrc }}"
        srcset="{% if isObject and not transform %}
          {{ image.getUrl({ width: smallWidth }) }} {{ smallWidth }}w,
          {{ jpegSrc }} {{ largeWidth }}w
        {% else %}
          {{ jpegSrc }} {{ largeWidth }}w
        {% endif %}"
        sizes="(max-width: 768px) 100vw, 50vw"
        alt="{{ altText }}"
        loading="{{ loading }}"
        width="{{ largeWidth }}"
        height="auto"
        class="w-full h-full object-cover"
      >
    </picture>
  {% endif %}
{% endmacro %}
