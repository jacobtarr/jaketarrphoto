{% macro renderImage(image, smallWidth, largeWidth, altText, transform = null, loading = 'lazy') %}
  {% if image %}
    {% set isObject = image is iterable and image is not string %}

    {% if isObject %}
      {# Use transform handle if it's a string, or use transform config #}
      {% set transformHandle = transform is string ? transform : null %}
      {% set transformConfig = transform is not string and transform is not null ? transform : null %}

      {% set jpegSrc = image.getUrl({
        transform: transformHandle ?? transformConfig,
        format: 'jpg'
      }) %}
      {% set webpSrc = image.getUrl({
        transform: transformHandle ?? transformConfig,
        format: 'webp'
      }) %}

      {% set width = transformHandle 
        ? (craft.app.imageTransforms.getTransformByHandle(transformHandle).width ?? largeWidth)
        : (transformConfig.width ?? largeWidth) 
      %}
    {% else %}
      {% set jpegSrc = image %}
      {% set webpSrc = image %}
      {% set width = largeWidth %}
    {% endif %}

    <picture>
      <source srcset="{{ webpSrc }}" type="image/webp">
      <source srcset="{{ jpegSrc }}" type="image/jpeg">
      <img 
        src="{{ jpegSrc }}"
        srcset="{{ jpegSrc }} {{ width }}w"
        sizes="(max-width: 768px) 100vw, 50vw"
        alt="{{ altText }}"
        loading="{{ loading }}"
        width="{{ width }}"
        height="auto"
        class="w-full h-full object-cover"
      >
    </picture>
  {% endif %}
{% endmacro %}
